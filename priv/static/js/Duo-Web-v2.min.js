!function(e,t){if("function"==typeof define&&define.amd)define([],t);else if("object"==typeof module&&module.exports)module.exports=t();else{var o=t();o._onReady(o.init),e.Duo=o}}(this,function(){var o,n,i,a,r,s,u,d,t=/^(?:AUTH|ENROLL)+\|[A-Za-z0-9\+\/=]+\|[A-Za-z0-9\+\/=]+$/,m=/^ERR\|[\w\s\.\(\)]+$/,c=/^DUO_OPEN_WINDOW\|/,f=["duo.com","duosecurity.com","duomobile.s3-us-west-1.amazonaws.com"];function h(){o="duo_iframe",n="",i="sig_response",d=u=s=r=a=void 0}function p(e,t){throw new Error("Duo Web SDK error: "+e+(t?"\nSee "+t+" for more information":""))}function e(e,t){return"dataset"in e?e.dataset[t]:e.getAttribute("data-"+t.replace(/([a-z])([A-Z])/,"$1-$2").toLowerCase())}function l(e,t,o,n){"addEventListener"in window?e.addEventListener(t,n,!1):e.attachEvent(o,n)}function g(e,t,o,n){"removeEventListener"in window?e.removeEventListener(t,n,!1):e.detachEvent(o,n)}function w(e){l(document,"DOMContentLoaded","onreadystatechange",e)}function v(e){g(document,"DOMContentLoaded","onreadystatechange",e)}function _(e){if(e){0===e.indexOf("ERR|")&&p(e.split("|")[1]),-1!==e.indexOf(":")&&2===e.split(":").length||p("Duo was given a bad token.  This might indicate a configuration problem with one of Duo's client libraries.","https://www.duosecurity.com/docs/duoweb#first-steps");var t=e.split(":");return e,r=t[0],s=t[1],{sigRequest:e,duoSig:t[0],appSig:t[1]}}}function b(){if(!(u=document.getElementById(o)))throw new Error('This page does not contain an iframe for Duo to use.Add an element like <iframe id="duo_iframe"></iframe> to this page.  See https://www.duosecurity.com/docs/duoweb#3.-show-the-iframe for more information.');D(),v(b)}function E(e){return Boolean(e.origin==="https://"+a&&"string"==typeof e.data&&(e.data.match(t)||e.data.match(m)||e.data.match(c)))}function y(e){if(E(e))if(e.data.match(c)){var t=e.data.substring("DUO_OPEN_WINDOW|".length);(function(e){if(!e)return!1;var t=document.createElement("a");{if(t.href=e,"duotrustedendpoints:"===t.protocol)return!0;if("https:"!==t.protocol)return!1}for(var o=0;o<f.length;o++)if(t.hostname.endsWith("."+f[o])||t.hostname===f[o])return!0;return!1})(t)&&window.open(t,"_self")}else O(e.data),g(window,"message","onmessage",y)}function D(){a||(a=e(u,"host"))||p("No API hostname is given for Duo to use.  Be sure to pass a `host` parameter to Duo.init, or through the `data-host` attribute on the iframe element.","https://www.duosecurity.com/docs/duoweb#3.-show-the-iframe"),r&&s||(_(e(u,"sigRequest")),r&&s||p("No valid signed request is given.  Be sure to give the `sig_request` parameter to Duo.init, or use the `data-sig-request` attribute on the iframe element.","https://www.duosecurity.com/docs/duoweb#3.-show-the-iframe")),""===n&&(n=e(u,"postAction")||n),"sig_response"===i&&(i=e(u,"postArgument")||i),u.src=["https://",a,"/frame/web/v1/auth?tx=",r,"&parent=",encodeURIComponent(document.location.href),"&v=2.7"].join(""),l(window,"message","onmessage",y)}function O(e){var t=document.createElement("input");t.type="hidden",t.name=i,t.value=e+":"+s;var o=document.getElementById("duo_form");o||(o=document.createElement("form"),u.parentElement.insertBefore(o,u.nextSibling)),o.method="POST",o.action=n,o.appendChild(t),"function"==typeof d?d.call(null,o):o.submit()}return h(),{init:function e(t){h(),t&&(t.host&&(a=t.host),t.sig_request&&_(t.sig_request),t.post_action&&(n=t.post_action),t.post_argument&&(i=t.post_argument),t.iframe&&(t.iframe.tagName?u=t.iframe:"string"==typeof t.iframe&&(o=t.iframe)),"function"==typeof t.submit_callback&&(d=t.submit_callback)),u?D():(u=document.getElementById(o))?D():w(b),v(e)},_onReady:w,_parseSigRequest:_,_isDuoMessage:E,_doPostBack:O}});
